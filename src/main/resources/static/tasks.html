<html>

<head>
    <meta charset="UTF-8">
    <title>Tasks</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
</head>

<body>
    <div id='tasks'></div>
    <a href="http://192.168.1.14:8080/login">Log In</a>
    <button id='button'>save</button>
</body>
<script>
    var url = 'http://192.168.1.14:8080/api/tasks';
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.send();
    xhr.onreadystatechange = function () {
        if (xhr.readyState == 4 && xhr.status == 200) {
            var res = JSON.parse(xhr.responseText);
            var brElem = document.createElement('br');
            var divElem = document.getElementById('tasks');
            var space = document.createTextNode(' ');
            for (let i = divElem.childNodes.length - 1; i >= 0; i--) {
                divElem.removeChild(divElem.childNodes[i]);
            }
            for (var i = 0; i < res.length; i++) {
                var obj = res[i];
                innerDiv = document.createElement('div');
                innerDiv.id = 'div'+i;
                if (!obj.tasks) {
                    obj.tasks = "";
                }
                var task = [obj.id, obj.name,obj.hours,obj.description,obj.assignedOn,obj.completed];
                var labels = ['ID:', 'Name:', 'Hours:', 'Desc:', 'Assigned On:','Comleted:'];
                let j = 1;
                for (let index = 0; index < task.length; index++) {
                    const element = task[index];
                    var input = document.createElement('input');
                        input.classList.add('element');
                    var text = document.createTextNode(element);
                    if (obj.id == element && index == 0) {
                        div2 = document.createElement('div');
                        div2.style.display = 'none';
                        div2.appendChild(text);
                        input = div2;
                        
                    } else {
                        input.value = text.textContent;
                        var label = document.createTextNode(labels[j]);


                        innerDiv.appendChild(label);
                        j++;
                    }
                    innerDiv.appendChild(input);
                }
                button = document.createElement('button');
                button.innerText = 'X';
                button.id = "button"+i;
                button.classList.add('btn','btn-danger');
                innerDiv.appendChild(button);
                divElem.appendChild(innerDiv);
                divElem.appendChild(document.createElement('br'));
            }
            
            var buttons = document.getElementsByClassName('btn-danger');
            for (let i = 0 ; i<buttons.length;i++) {
                var button  = buttons[i];
                button.addEventListener('click',function(){
                    var id = this.id.replace('button','');
                    var divId = document.getElementById('div'+id);
                    var objId = divId.childNodes[0].innerText;
                    var delRequest = new XMLHttpRequest();
                    delRequest.open('DELETE',url+'/'+objId);
                    delRequest.send();
                    delRequest.onreadystatechange = function(){
                        if(delRequest.readyState == 4 && delRequest.status == 200){
                            divId.remove();
                            alert('Element Succesfully Deleted');
                        }
                    }
                });
            }
    }
}


</script>

</html>